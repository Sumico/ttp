<template>

<!--one more template###############################################################################################-->
<template
name="TESTS_SET_1" 
description="Groups to test various function"
>
<vars>
vlans = "unrange(rangechar='-', joinchar=',') | joinmatches(',')"
</vars>

<!--to test chain with unrange and joinmatches-->
<input name="test1" load="text" groups="interfaces">
interface GigabitEthernet3/3
 switchport trunk allowed vlan add 138,166-173 
 switchport trunk allowed vlan add 400,401,410
</input>

<group name="interfaces" output="test1">
interface {{ interface }}
 switchport trunk allowed vlan add {{ trunk_vlans | chain("vlans") }}
</group>

<output 
name="test1" 
load="json" 
functions="is_equal" 
description="test vlans unrange and joinmatches functions" 
>
{
    "interfaces": {
        "interface": "GigabitEthernet3/3",
        "trunk_vlans": "138,166,167,168,169,170,171,172,173,400,401,410"
    }
}
</output>


<!--test contains('vlan') for interfaces-->
<input name="test2" load="text" groups="SVIs">
interface Vlan123
 description Desks vlan
 ip address 192.168.123.1 255.255.255.0
!
interface GigabitEthernet1/1
 description to core-1
!
interface Vlan222
 description Phones vlan
 ip address 192.168.222.1 255.255.255.0
!
interface Loopback0
 description Routing ID loopback
</input>

<group name="SVIs" output="test2">
interface {{ interface | contains("Vlan") }}
 description {{ description | ORPHRASE}}
 ip address {{ ip }} {{ mask }}
</group>

<output 
name="test2" 
load="python" 
functions="is_equal" 
description="test that only interaces with vlan got to results"
>
{'SVIs': [{'interface': 'Vlan123', 'description': 'Desks vlan', 'ip': '192.168.123.1', 'mask': '255.255.255.0'}, {'interface': 'Vlan222', 'description': 'Phones vlan', 'ip': '192.168.222.1', 'mask': '255.255.255.0'}]}
</output>


<!--test containsall for group results-->
<input 
name="test3" 
load="text" 
groups="interfaces_contansall"
>
interface Port-Chanel11
  description Storage Management
!
interface Loopback0
  description RID
  ip address 10.0.0.3/24
!
interface Vlan777
  description Management
  ip address 192.168.0.1/24
  vrf MGMT
</input>

<group name="interfaces_contansall" containsall="ip, vrf" output="test3">
interface {{ interface }}
  description {{ description }}
  ip address {{ ip }}/{{ mask }}
  vrf {{ vrf }}
</group>

<output name="test3"
load="json"
functions="is_equal"
description="test containsall for group"
>
{
    "interfaces_contansall": {
        "description": "Management",
        "interface": "Vlan777",
        "ip": "192.168.0.1",
        "mask": "24",
        "vrf": "MGMT"
    }
}
</output>


<!--test containsany for group results-->
<input 
name="test4" 
load="text" 
groups="interfaces_contains"
>
interface Port-Chanel11
  description Storage Management
!
interface Loopback0
  description RID
  ip address 10.0.0.3/24
!
interface Vlan777
  description Management
  ip address 192.168.0.1/24
  vrf MGMT
</input>

<group name="interfaces_contains" contains="ip,vrf" output="test4">
interface {{ interface }}
  description {{ description }}
  ip address {{ ip }}/{{ mask }}
  vrf {{ vrf }}
</group>

<output name="test4"
load="json"
functions="is_equal"
description="test contains any for group"
>
{
    "interfaces_contains": [
        {
            "description": "RID",
            "interface": "Loopback0",
            "ip": "10.0.0.3",
            "mask": "24"
        },
        {
            "description": "Management",
            "interface": "Vlan777",
            "ip": "192.168.0.1",
            "mask": "24",
            "vrf": "MGMT"
        }
    ]
}
</output>


<!--test group table method-->
<input 
name="test5" 
load="text" 
groups="arp_table"
>
CSR1Kv-3-lab#show ip arp
Protocol  Address          Age (min)  Hardware Addr   Type   Interface
Internet  10.1.13.1              98   0050.5685.5cd1  ARPA   GigabitEthernet2.13
Internet  10.1.13.3               -   0050.5685.14d5  ARPA   GigabitEthernet2.13
</input>

<group name="arp_table" method="table" output="test5">
Internet  {{ ip }}  {{ age | DIGIT }}   {{ mac }}  ARPA   {{ interface }}
Internet  {{ ip }}  -                   {{ mac }}  ARPA   {{ interface }}
</group>

<output name="test5"
load="json"
functions="is_equal"
description="test group table method"
>
{
    "arp_table": [
        {
            "age": "98",
            "interface": "GigabitEthernet2.13",
            "ip": "10.1.13.1",
            "mac": "0050.5685.5cd1"
        },
        {
            "interface": "GigabitEthernet2.13",
            "ip": "10.1.13.3",
            "mac": "0050.5685.14d5"
        }
    ]
}
</output>


<!--test dynamic path-->
<input 
name="test6" 
load="text" 
>
ucs-core-switch-1#show run | section bgp
router bgp 65100
  vrf CUST-1
    neighbor 59.100.71.193
      remote-as 65101
      description peer-1
      address-family ipv4 unicast
        route-map RPL-1-IMPORT-v4 in
        route-map RPL-1-EXPORT-V4 out
      address-family ipv6 unicast
        route-map RPL-1-IMPORT-V6 in
        route-map RPL-1-EXPORT-V6 out
    neighbor 59.100.71.209
      remote-as 65102
      description peer-2
      address-family ipv4 unicast
        route-map RPL-2-IMPORT-V6 in
        route-map RPL-2-EXPORT-V6 out
</input>

<group name="router.bgp.BGP_AS_{{ asn }}" input="test6" output="test6">
router bgp {{ asn }}
  <group name="vrfs.{{ vrf_name }}">
  vrf {{ vrf_name }}
    <group name="peers.{{ peer_ip }}">
    neighbor {{ peer_ip }}
      remote-as {{ peer_asn }}
      description {{ peer_description }}
	  <group name="afi.{{ afi }}.unicast">
      address-family {{ afi }} unicast
        route-map {{ rpl_in }} in
        route-map {{ rpl_out }} out
	  </group>
	</group>
   </group>
</group>

<output name="test6"
load="python"
functions="is_equal"
description="test dynamic path"
>
{'router': {'bgp': {'BGP_AS_65100': {'vrfs': {'CUST-1': {'peers': {'59.100.71.193': {'peer_asn': '65101', 'peer_description': 'peer-1', 'afi': {'ipv4': {'unicast': {'rpl_in': 'RPL-1-IMPORT-v4', 'rpl_out': 'RPL-1-EXPORT-V4'}}, 'ipv6': {'unicast': {'rpl_in': 'RPL-1-IMPORT-V6', 'rpl_out': 'RPL-1-EXPORT-V6'}}}}, '59.100.71.209': {'peer_asn': '65102', 'peer_description': 'peer-2', 'afi': {'ipv4': {'unicast': {'rpl_in': 'RPL-2-IMPORT-V6', 'rpl_out': 'RPL-2-EXPORT-V6'}}}}}}}}}}}
</output>


<!--test set function-->
<input 
name="test7" 
load="text" 
>
interface GigabitEthernet3/4
 switchport mode access 
 switchport trunk encapsulation dot1q
 switchport mode trunk
 switchport nonegotiate
!
interface GigabitEthernet3/7
 switchport mode access 
 switchport mode trunk
 switchport nonegotiate
!
</input>

<group name="interfacesset" input="test7" output="test7">
interface {{ interface }}
 switchport mode access {{ mode_access | set("True") }}
 switchport trunk encapsulation dot1q {{ encap | set("dot1q") }}
 switchport mode trunk {{ mode | set("Trunk") }} {{ vlans | set("all_vlans") }}
 shutdown {{ disabled | set("True") }}
!{{ _end_ }}
</group>

<output name="test7"
functions="is_equal"
description="test set function"
load="python"
>
{'interfacesset': [{'interface': 'GigabitEthernet3/4', 'mode_access': 'True', 'encap': 'dot1q', 'mode': 'Trunk', 'vlans': 'all_vlans'}, {'interface': 'GigabitEthernet3/7', 'mode_access': 'True', 'mode': 'Trunk', 'vlans': 'all_vlans'}]}
</output>


<!--output to print raw python result to screen
<output
name="print_python"
returner="terminal"
format="raw"
/>
-->

<!--final output to put all results in tabulate table-->
<output 
format="tabulate"
returner="terminal"
format_attributes = "tablefmt='fancy_grid'"
/>
</template>


<!--one more teamplte###############################################################################################-->
<template
name="TESTS-VARs"
description="test vars path forming and saving in results"
>

<vars name="vars.info*.bla">
hostname='gethostname' 
</vars>

<vars name=''>
caps = "ORPHRASE | upper"
</vars>

<vars name="vars.info*.bla">
filename='getfilename' 
</vars>

<input name="test1" load="text" groups="interfaces">
router1#show run int vlan 777
interface Vlan777
 description Management
 ip address 192.168.0.1/24
 vrf MGMT
</input>

<group name="interfaces" output="test1">
interface {{ interface }}
 description {{ description }}
 ip address {{ ip }} {{ mask }}
 vrf {{ vrf }}
</group>

<output name="test1"
load="json"
functions="is_equal"
description="test vars path forming and saving in results"
>
{
    "interfaces": {
        "description": "Management",
        "interface": "Vlan777",
        "vrf": "MGMT"
    },
    "vars": {
        "info": [
            {
                "bla": {
                    "filename": "text_data",
                    "hostname": false
                }
            }
        ]
    }
}
</output>

<!--final output to put all results in tabulate table-->
<output 
returner="terminal"
format="tabulate"
format_attributes = "tablefmt='fancy_grid'"
/>
</template>



<!--one more teamplte###############################################################################################-->
<template
name="TESTS-CSV-TABULATE-TABLES"
description="template to test csv/tabulate global and group specific outputters"
>
<!--test csv and tabulate outputters-->
<input name="test1" load="text" groups="interfaces.trunks, interfaces2.trunks2">
interface GigabitEthernet3/3
 switchport trunk allowed vlan add 138,166-173 
 description some description
!
interface GigabitEthernet3/4
 switchport trunk allowed vlan add 100-105
!
interface GigabitEthernet3/5
 switchport trunk allowed vlan add 459,531,704-707
 ip address 1.1.1.1 255.255.255.255
 vrf forwarding ABC_VRF
!
</input>

<input name="test1_1" load="text" groups="interfaces.trunks">
interface GigabitEthernet3/7
 switchport trunk allowed vlan add 138,166-173 
 description some description
!
interface GigabitEthernet3/8
 switchport trunk allowed vlan add 100-105
!
interface GigabitEthernet3/9
 switchport trunk allowed vlan add 459,531,704-707
 ip address 1.1.1.1 255.255.255.255
 vrf forwarding ABC_VRF
!
</input>

<!--group for global outputs:-->
<group name="interfaces.trunks">
interface {{ interface }}
 switchport trunk allowed vlan add {{ trunk_vlans }}
 description {{ description | ORPHRASE }}
 vrf forwarding {{ vrf }}
 ip address {{ ip }} {{ mask }}
!{{ _end_ }}
</group>

<!--global outputs:-->
<out
name="out_csv"
path="interfaces.trunks"
format="csv"
returner="terminal"
sep=","
missing="undefined"
load="python"
/>

<out
name="out_tabulate"
path="interfaces.trunks"
format="tabulate"
returner="terminal"
headers="interface, vrf, ip, mask, description"
format_attributes = "tablefmt='fancy_grid'"
/>

<!--group with group specific outputs:-->
<group name="interfaces2.trunks2" output="out_tabulate2, out_csv2">
interface {{ interface }}
 switchport trunk allowed vlan add {{ trunk_vlans }}
 description {{ description | ORPHRASE }}
 vrf forwarding {{ vrf }}
 ip address {{ ip }} {{ mask }}
!{{ _end_ }}
</group>

<!--group specific outputs:-->
<out
name="out_csv2"
path="interfaces2.trunks2"
format="csv"
returner="terminal"
sep=","
missing="undefined"
load="python"
/>

<out
name="out_tabulate2"
path="interfaces2.trunks2"
format="tabulate"
returner="terminal"
/>
</template>

</template>